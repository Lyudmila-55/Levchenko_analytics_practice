= Топики Kafka для микросервисов строительного магазина

Данный документ описывает структуру топиков Kafka, используемых для обмена сообщениями между микросервисами строительного магазина. В нем представлены наименования топиков для запросов и ответов, а также их назначение.

=== Каталог товаров
* `catalog.request` – Запрос на создание, обновление или удаление товаров, категорий и характеристик.
* `catalog.response` – Ответ на запрос (успех, ошибка, подтверждение).

=== Оформление заказов
* `orders.request` – Запрос на создание, изменение или отмену заказа.
* `orders.response` – Ответ с подтверждением, статусом или ошибкой.

=== Оплата
* `payments.request` – Запрос на обработку платежа или возврата средств.
* `payments.response` – Ответ с результатом платежа (успех, ошибка).

=== Складская система
* `warehouse.request` – Запрос на обновление остатков или поступления от поставщиков.
* `warehouse.response` – Ответ с подтверждением изменений.

=== Доставка
* `delivery.request` – Запрос на отправку заказа или обновление статуса доставки.
* `delivery.response` – Ответ с подтверждением или ошибкой.

=== Управление магазинами
* `stores.request` – Запрос на обновление наличия товаров или изменений акций в офлайн-магазинах.
* `stores.response` – Ответ с подтверждением изменений.

=== CRM и аналитика
* `crm.request` – Запрос на обновление профиля клиента, запуск маркетинговой кампании или сбор аналитики.
* `crm.response` – Ответ с подтверждением или отчетом.

=== Пользователи и доступ
* `users.request` – Запрос на аутентификацию, изменение ролей или логирование действий.
* `users.response` – Ответ с подтверждением или ошибкой.


== Структура сообщений в Kafka
_Каждое сообщение в Kafka состоит из нескольких ключевых частей:_

* **Key (Ключ)** – определяет, какой партиции Kafka будет назначено сообщение (может быть null или, например, category_id).
* **Value (Значение)** – основное содержимое сообщения (JSON, Avro, Protobuf и др.).
* **Headers (Заголовки)** – метаданные, например, correlation_id для трассировки.
* **Timestamp (Временная метка)** – когда сообщение было создано или записано.

=== Пример сообщений для топика `catalog.request` 
==== Пример в формате JSON
[source,json]
----
{
  "key": "uuid-5678",
  "value": {
    "action": "create",
    "category": {
      "category_id": "uuid-5678",
      "name": "Краски и лаки",
      "description": "Краски для внутренних и наружных работ"
    },
    "timestamp": "2025-02-10T15:00:00+03:00",
    "request_id": "req-1234"
  },
  "headers": {
    "trace_id": "trace-9876",
    "source_system": "inventory-service",
    "priority": "high"
  },
  "timestamp": "2025-02-10T15:30:00+03:00"
  "offset": 123
}
----

==== Пример  в формате Avro (Схема):
[source,json]
----
{
  "type": "record",
  "name": "CategoryRequest",
  "namespace": "com.store.catalog",
  "fields": [
    {
      "name": "action",
      "type": "string"
    }
    {
      "name": "category",
      "type": {
        "type": "record",
        "name": "Category",
        "fields": [
          {
            "name": "category_id",
            "type": "string"
          },
          {
            "name": "name",
            "type": "string"
          },
          {
            "name": "description",
            "type": "string"
          }
        ]
      }
    }
    {
      "name": "timestamp",
      "type": "string"
    },
    {
      "name": "request_id",
      "type": "string"
    }
  ]
}
----

==== Пример  в формате Avro (Данные):
[source,json]
----
{
  "action": "create",
  "category": {
    "category_id": "uuid-5678",
    "name": "Краски и лаки",
    "description": "Краски для внутренних и наружных работ"
  },
  "timestamp": "2025-02-12T15:00:00+03:00",
  "request_id": "req-1234"
}
----

==== Пример  в формате Avro (Сообщение):
[source,json]
----
"key": "uuid-5678"
"value": {
  "action": "create",
  "category": {
    "category_id": "uuid-5678",
    "name": "Краски и лаки",
    "description": "Краски для внутренних и наружных работ"
  },
  "timestamp": "2025-02-12T15:00:00+03:00",
  "request_id": "req-1234"
}
----

=== Пример  в формате Protobuf (Схема)
[source,json]
----
syntax = "proto3";

package com.store.catalog;

// Сообщение для запроса на создание, обновление или удаление категории
message CategoryRequest {
  string key = 1;
  Value value = 2;
  Headers headers = 3;
  string timestamp = 4;
  int64 offset = 5;
  
  // Вложенные сообщения
  message Value {
    string action = 1;
    Category category = 2;
    string timestamp = 3;
    string request_id = 4;

    message Category {
      string category_id = 1;
      string name = 2;
      string description = 3;
    }
  }

  message Headers {
    string trace_id = 1;
    string source_system = 2;
    string priority = 3;
  }
}
----

=== Пример  в формате Protobuf (Сообщение)
[source,json]
----
CategoryRequest {
  key: "uuid-5678"
  value: {
    action: "create"
    category: {
      category_id: "uuid-5678"
      name: "Краски и лаки"
      description: "Краски для внутренних и наружных работ"
    }
    timestamp: "2025-02-10T15:00:00+03:00"
    request_id: "req-1234"
  }
  headers: {
    trace_id: "trace-9876"
    source_system: "inventory-service"
    priority: "high"
  }
  timestamp: "2025-02-10T15:30:00+03:00"
  offset: 123
}
----